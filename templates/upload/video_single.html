{% extends 'base.html' %}
{% load i18n %}
{% block title %}{{ video.title }} | {% trans 'Learning management system' %}{% endblock title %}
{% load static %}

{% block content %}

<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">{% trans 'Home' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'programs' %}">{% trans 'Programs' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'program_detail' video.course.program.id %}">{{ video.course.program }}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'course_detail' video.course.slug %}">{{ video.course }}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ video.title }}</li>
    </ol>
</nav>
    
<p class="title-1">{{ video.title }}</p>
<br><br>

<div class="col-md-10 mx-auto d-block">
    <div class="">
        <video src="{{ video.video.url }}" controls></video>
    </div>
    <p><i class="fas fa-calendar"></i> {{ video.timestamp|timesince }} {% trans 'ago' %}</p>
    {% if video.summary %}
    <p class="text-orange text-center">{{ video.summary }}</p>
    {% else %}
    {% trans 'No video description set.' %}
    {% endif %}
</div>

<!-- Section des commentaires -->
<div class="mt-5">
    <h3>{% trans 'Commentaires' %}</h3>
    {% if video.comments.all %}
        <ul class="list-unstyled">
            {% for comment in video.comments.all %}
                <li class="mb-3">
                    <div class="card">
                        <div class="card-body">
                            <strong>{{ comment.user.username }}</strong>
                            <small class="text-muted"> - {{ comment.timestamp|timesince }} {% trans 'ago' %}</small>
                            <p class="mt-2">{{ comment.content }}</p>
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>{% trans 'No comments yet.' %}</p>
    {% endif %}
</div>

<!-- Formulaire pour ajouter un commentaire -->
{% if request.user.is_authenticated %}
<div class="mt-4">
    <h4>{% trans 'Add a comment' %}</h4>
    <form method="post" action="{% url 'add_comment_to_video' video.id %}">
        {% csrf_token %}
        <div class="form-group">
            <textarea name="content" class="form-control" rows="3" placeholder="{% trans 'Your comment...' %}" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">{% trans 'Submit' %}</button>
    </form>
</div>
{% else %}
<div class="mt-4">
    <p>{% trans 'You must be logged in to leave a comment.' %} <a href="{% url 'login' %}">{% trans 'Login here' %}</a></p>
</div>
{% endif %}

{% endblock content %}